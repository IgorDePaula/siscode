(function(f,g,b,c,a,e){var d=window.App||(window.App={});d.CourseSlotModel=g.Model.extend();d.CourseSlotView=g.View.extend({tagName:"div",className:"schedule-course-slot",render:function(){var h=c.compile(f("#course-slot-view-tmpl").html()),i;i=this.model.toJSON();i.Course=this.model.courseModel.toJSON();i.start_time=i.start_time.substr(0,5);i.end_time=i.end_time.substr(0,5);this.$el.html(h(i));this.$(".schedule-course-slot-wrapper").css({backgroundColor:this.model.courseModel.get("color").background,borderColor:this.model.courseModel.get("color").border});return this},afterInsert:function(){this.$el.tooltip({tooltip:".tooltip-content"})}});d.CourseSlotCollection=g.Collection.extend({model:d.CourseSlotModel});d.CourseModel=g.Model.extend();d.CourseCollection=g.Collection.extend({model:d.CourseModel,maxPage:0,page:0,webroot:null,router:null,cacheKey:0,colors:[{background:"#73A5F7",border:"#03F"},{background:"#FF828E",border:"#D80505"},{background:"#FF71FF",border:"#B300B3"},{background:"#FFFF80",border:"#FF0"},{background:"#AFA",border:"#80FF00"},{background:"#FFA980",border:"#FF8000"}],initialize:function(h){this.webroot=h.webroot;this.router=h.router;this.cacheKey=h.cacheKey;this.on("reset",this.fixSlots,this);this.router.on("urlChanged",this.fetchUrl,this)},fetchUrl:function(i){var h=this;this.url=this.webroot+"courses/fetch/"+i+".json?_="+this.cacheKey;this.trigger("isLoading",true);this.reset();this.fetch({reset:true,complete:function(){h.trigger("isLoading",false)}})},fixSlots:function(k){var j,i=this,h;b.each(k.models,function(l,m){if(i.colors[m]!==e){h=i.colors[m]}else{h=i.colors[m%i.colors.length]}l.set("color",h);j=l.get("CourseSlot");b.each(j.models,function(n){n.courseModel=l})})},parse:function(h){var i=[];this.maxPage=this.router.maxPage=h.pagination.total;this.page=this.router.page=h.pagination.page;b.each(h.content,function(l){var j=[],k;b.each(l.CourseSlot,function(m){j.push(new d.CourseSlotModel(m))});l.Course.subject_code=l.Subject.code;k=l.Course;k.CourseSlot=new d.CourseSlotCollection(j);i.push(k)});return i}});d.CourseScheduleView=g.View.extend({el:".schedule",errorMessages:["No results! Take a break this semester, work at McDonalds instead","No results! Seriously, flipping burgers is fun","No results! I like fries with my burger","No results! One tawouk, toum extra please","Hooray! No need to come to uni this semester. Just kidding, No results","No results! Have you considered dropping out?","No results! Try LUCK 101","No results! Never give up, Bill Gates was a dropout and look where he is today"],initialize:function(i){var h=this;this.collection=new d.CourseCollection({webroot:i.webroot,router:i.router,cacheKey:i.cacheKey});this.collection.on("reset",this.addAll,this);this.collection.on("isLoading",this.loading,this);this.$(".paginator").each(function(){f(this).html((new d.PaginationView({router:i.router,collection:h.collection})).render().$el)})},loading:function(h){if(h){this.$(".schedule-loader").show()}else{this.$(".schedule-loader").hide()}},addAll:function(k,j){var h=this.$(".schedule-empty-error"),i=this;this.$(".schedule-day").html("");if(j.success&&k.models.length===0){h.html(this.errorMessages[Math.floor(Math.random()*this.errorMessages.length)]);h.show()}else{h.hide()}b.each(k.models,function(l){i.addOne(l)})},addOne:function(n){var i,m,l=this,k,o,j,h;b.each(n.get("CourseSlot").models,function(p){i=new d.CourseSlotView({model:p});i.render();m=l.$(".day-"+p.get("day"));m.append(i.$el);i.afterInsert();o=l.fixTime(p.get("start_time"));j=l.fixTime(p.get("end_time"));k=40+(o*40);h=40+(j*40)-k;i.$el.css({position:"absolute",top:k+"px",height:h+"px"})})},fixTime:function(h){h=h.split(":");h[0]=+h[0];h[1]=+h[1];h=(h[0]-7)+h[1]/60;return h}});d.PaginationView=g.View.extend({tagName:"div",template:c.compile(f("#pagination-view-tmpl").html()),router:null,events:{"click .paginator-next":"updateUrlNext","click .paginator-previous":"updateUrlPrevious"},updateUrlNext:function(){this.router.nextPage()},updateUrlPrevious:function(){this.router.previousPage()},initialize:function(h){this.router=h.router;this.collection.on("reset",this.render,this)},render:function(){var h={page:this.collection.page,maxPage:this.collection.maxPage};this.$el.html(this.template(h));if(+this.collection.page>=+this.collection.maxPage){this.$(".paginator-next").addClass("paginator-disabled")}if(+this.collection.page===1){this.$(".paginator-previous").addClass("paginator-disabled")}if(this.collection.maxPage===0){this.$el.hide()}else{this.$el.show()}return this}})}(jQuery,Backbone,_,Handlebars,amplify));