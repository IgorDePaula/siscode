(function(C,F,S,j,v,A){j.registerHelper("equal",function(H,U,T){if(arguments.length<3){throw new Error("Handlebars Helper equal needs 2 parameters")}if(+H!==+U){return T.inverse(this)}else{return T.fn(this)}});var s,N,i,O,L,e,b,d,P,g,Q,M,t,K,m,x,n,B,D,I,u,G,q,J,E,o,w,R,r,l,p,h,k,z,f,c,a,y;c=C("body").data("webroot");f=C("body").data("cache_key");y="click";a=navigator.userAgent.match(/mobile/i);if(a&&"ontouchstart" in document.documentElement){y="touchstart"}k=F.View.extend({el:"body",events:{keyup:"keyup"},keyup:function(H){if(C(H.target).is("input")){return}if(H.keyCode===37){this.trigger("leftArrowUp")}else{if(H.keyCode===39){this.trigger("rightArrowUp")}}}});z=new k();g=F.Model.extend({});Q=F.Collection.extend({model:g});K=F.View.extend({template:j.compile(C("#course-input-subjects").html()),render:function(){var H=[];S.each(this.collection.models,function(T){H.push(T.toJSON())});this.$el.html(this.template({subjects:H})).val(this.options.selected_id);return this}});s=F.Model.extend({defaults:{subject_id:null,number:null,crn:null},clear:function(){this.destroy()}});e=F.View.extend({tagName:"div",className:"cil-course-input",template:j.compile(C("#course-input-tmpl").html()),numberTemplate:j.compile(C("#course-input-numbers").html()),events:{"change select[name=subject_id]":"fillNumber","click .cil-remove-course":"removeCourse","keyup .cil-course-crn":"crnKeyUp"},crnKeyUp:function(H){if(this.$(H.target).val().length>0){this.$("select").prop("disabled",true).trigger("liszt:updated")}else{this.$("select").prop("disabled",false).trigger("liszt:updated")}},fillNumber:function(){var U,T,H;U=this.$("select[name=subject_id]").val();if(U){H=t.get(U).toJSON()}else{H={numbers:[]}}this.$("select[name=number]").html(this.numberTemplate(H)).trigger("liszt:updated")},render:function(){var H,T=[],U;U=this.model.toJSON();S.each(t.models,function(V){T.push(V.toJSON())});U.subjects=T;this.$el.html(this.template(U)).find("select[name=subject_id]").val(this.model.get("subject_id")).trigger("change").end().find("select[name=number]").val(this.model.get("number"));return this},afterRender:function(){this.$("select").chosen()},initialize:function(){this.model.on("destroy",this.remove,this)},removeCourse:function(){this.model.clear()}});N=F.Collection.extend({model:s});O=F.View.extend({el:".cil",page:0,closed:false,events:{"keypress .course-input":"keyLog"},keyLog:function(H){if(H.keyCode===13){this.updateUrlEvent()}},initialize:function(){this.collection.on("add",this.addInput,this);this.collection.on("reset",this.closeInputs,this);z.on("leftArrowUp",this.updatePrevious,this);z.on("rightArrowUp",this.updateNext,this)},updatePrevious:function(){this.updateUrl(-1)},updateNext:function(){this.updateUrl(1)},closeInputs:function(){this.$el.addClass("cil-hidden");C("body").addClass("cil-hidden")},openInputs:function(){this.$el.removeClass("cil-hidden");C("body").removeClass("cil-hidden")},addInput:function(T){var H,U;H=new e({model:T});H.render();U=H.$el;this.$(".cil-courses").append(U);H.afterRender()},afterRender:function(){var H=this,T;this.$(".cil-add-course").on("click",function(){H.addInputModel()});this.$(".cil-submit").on("click",function(){H.updateUrlEvent()});T="click";if(a){T="touchstart"}this.$(".cil-expand-arrow").on(T,function(){H.openInputs();return false});return this},addInputModel:function(){this.collection.add(new s())},updateUrlEvent:function(){this.updateUrl();this.closeInputs()},updateUrl:function(U){if(U===A){this.page=1}else{if(U===-1){this.page-=1}else{if(U===1){if(this.page<I.maxPage){this.page+=1}}}}this.page=Math.max(1,this.page);var T=[],H="",W=[],V;this.$(".cil-course-input").each(function(){T.push([C(this).find("select[name=subject_id]").val(),C(this).find("select[name=number]").val(),C(this).find("input[name=crn]").val()])});S.each(T,function(X){H=H+X.join("-")+"_"});C('input[name^="filter"]').each(function(){if(C(this).prop("checked")){W.push(C(this).val())}});W=W.join("-")+"_";H="c/"+this.page+"_"+W+H.substr(0,H.length-1);P.navigate(H,{trigger:true})},updateFilters:function(U){var H,T;T=this;H=T.$('input[name^="filter"]');H.prop("checked",false);S.each(U,function(V){T.$('input[name="filter['+V+']"]').prop("checked",true)})}});M=C("#subjects-data").data("subjects");t=new Q();t.reset(M);i=new N();L=(new O({collection:i})).afterRender();q=F.Model.extend({});J=F.Collection.extend({model:q});m=F.Model.extend({});D=F.Collection.extend({model:m,maxPage:0,page:0,url:c+"courses/fetch",colors:[{background:"#73A5F7",border:"#03F"},{background:"#FF828E",border:"#D80505"},{background:"#FF71FF",border:"#B300B3"},{background:"#FFFF80",border:"#FF0"},{background:"#AFA",border:"#80FF00"},{background:"#FFA980",border:"#FF8000"}],initialize:function(){this.on("reset",this.fixSlots,this)},fixSlots:function(V){var U,T,H;T=this;S.each(V.models,function(W,X){if(T.colors[X]!==A){H=T.colors[X]}else{H=T.colors[X%T.colors.length]}W.set("color",H);U=W.get("CourseSlot");S.each(U.models,function(Y){Y.courseModel=W})})},parse:function(H){var T=[];this.maxPage=H.pagination.total;this.page=H.pagination.page;S.each(H.content,function(W){var U=[],V;S.each(W.CourseSlot,function(X){U.push(new q(X))});W.Course.subject_code=t.get(W.Course.subject_id).get("code");V=W.Course;V.CourseSlot=new J(U);T.push(V)});return T}});u=F.View.extend({el:".schedule",errorMessages:["No results! Take a break this semester, work at McDonalds instead","No results! Seriously, flipping burgers is fun","No results! I like fries with my burger","No results! One tawouk, toum extra please","Hooray! No need to come to uni this semester. Just kidding, No results","No results! Have you considered dropping out?","No results! Try LUCK 101","No results! Never give up, Bill Gates was a dropout and look where he is today"],initialize:function(){var H=this;this.collection.on("reset",this.addAll,this);this.$(".paginator").each(function(){C(this).html((new o({collection:H.collection})).render().$el)})},loading:function(H){if(H){this.$(".schedule-loader").show()}else{this.$(".schedule-loader").hide()}},addAll:function(V,U){var H,T;this.$(".schedule-day").html("");T=this;H=this.$(".schedule-empty-error");if(U.success&&V.models.length===0){H.html(this.errorMessages[Math.floor(Math.random()*this.errorMessages.length)]);H.show()}else{H.hide()}S.each(V.models,function(W){T.addOne(W)})},addOne:function(Y){var T,X,W,V,Z,U,H;W=this;S.each(Y.get("CourseSlot").models,function(aa){T=new E({model:aa});T.render();X=W.$(".day-"+aa.get("day"));X.append(T.$el);T.afterInsert();Z=W.fixTime(aa.get("start_time"));U=W.fixTime(aa.get("end_time"));V=40+(Z*40);H=40+(U*40)-V;T.$el.css({position:"absolute",top:V+"px",height:H+"px"})})},fixTime:function(H){H=H.split(":");H[0]=+H[0];H[1]=+H[1];H=(H[0]-7)+H[1]/60;return H}});E=F.View.extend({tagName:"div",className:"schedule-course-slot",render:function(){var H,U,T;H=C("#course-slot-view-tmpl").html();U=j.compile(H);T=this.model.toJSON();T.Course=this.model.courseModel.toJSON();T.start_time=T.start_time.substr(0,5);T.end_time=T.end_time.substr(0,5);this.$el.html(U(T));this.$(".schedule-course-slot-wrapper").css({backgroundColor:this.model.courseModel.get("color").background,borderColor:this.model.courseModel.get("color").border});return this},afterInsert:function(){this.$el.tooltip({tooltip:".tooltip-content"})}});o=F.View.extend({tagName:"div",events:{"click .paginator-next":"updateUrlNext","click .paginator-previous":"updateUrlPrevious"},updateUrlNext:function(){if(+this.collection.page<+this.collection.maxPage){L.updateUrl(1)}},updateUrlPrevious:function(){L.updateUrl(-1)},initialize:function(){this.collection.on("reset",this.render,this)},render:function(){var H,U,T;H=C("#pagination-view-tmpl").html();U=j.compile(H);T={page:this.collection.page,maxPage:this.collection.maxPage};this.$el.html(U(T));if(+this.collection.page>=+this.collection.maxPage){this.$(".paginator-next").addClass("paginator-disabled")}if(+this.collection.page===1){this.$(".paginator-previous").addClass("paginator-disabled")}if(this.collection.maxPage===0){this.$el.hide()}else{this.$el.show()}return this}});I=new D();G=new u({collection:I});w=F.Model.extend({defaults:{url:null,name:null},sync:function(Y,U,T){var V,W,X,H;if(Y==="create"){V=v.store("savedCombinations");if(!V){V=[]}W=this.toJSON();W.id=S.uniqueId();V.push(W);v.store("savedCombinations",V);T.success(W)}else{if(Y==="delete"){X=U.get("id");V=v.store("savedCombinations",V);H=null;S.each(V,function(aa,Z){if(aa.id===X){H=Z;return false}});if(H!==null){V.splice(H,1)}v.store("savedCombinations",V)}else{if(Y==="update"){X=U.get("id");V=v.store("savedCombinations",V);H=null;S.each(V,function(aa,Z){if(aa.id===X){V[Z]=U.toJSON();return false}});v.store("savedCombinations",V)}}}},clear:function(){this.destroy()}});R=F.View.extend({tagName:"li",editMode:false,$template:j.compile(C("#foot-bar-combination-tmpl").html()),events:function(){var H={};H[y+" a"]="goToSavedUrl";H[y+" .foot-bar-remove"]="removeCombination";H[y+" .foot-bar-edit"]="editCombination";H["keypress input"]="updateCombination";return H},editCombination:function(){if(this.editMode){this.update()}else{this.editMode=true;this.$(".foot-bar-combination-name").hide();this.$("input").show().focus().select()}return false},updateCombination:function(H){if(H.keyCode===13){this.update()}},update:function(){var H;this.$(".foot-bar-combination-name").show();H=this.$("input").hide().val();this.model.save({name:H});this.editMode=false},removeCombination:function(){this.model.clear();return false},goToSavedUrl:function(){P.navigate("c/"+this.model.get("url"),{trigger:true});return false},initialize:function(){this.model.on("destroy",this.remove,this);this.model.on("change:name",this.render,this)},render:function(){this.$el.html(this.$template(this.model.toJSON()));return this}});r=F.Collection.extend({model:w,sync:function(V,U,H){if(V==="read"){var T;T=v.store("savedCombinations");H.success(T)}}});l=F.View.extend({el:".foot-bar",toggled:false,events:function(){var H=a?{"touchstart .foot-bar-toggle":"toggleFoot","touchstart .foot-bar-add":"save"}:{"click .foot-bar-toggle":"toggleFoot","click .foot-bar-add":"save"};return H},initialize:function(){this.collection.on("add",this.addOne,this);this.collection.on("reset",this.addAll,this)},addAll:function(T){var H;H=this;S.each(T.models,function(U){H.addSaved(U,true)})},addOne:function(H){this.addSaved(H)},addSaved:function(T,V){var H,U;H=new R({model:T});H.render();U=H.$el;this.$(".foot-bar-combination").prepend(U);if(!V){H.editCombination();if(!this.toggled){this.toggleFoot()}}},toggleFoot:function(){var H;H=this.$(".foot-bar-arrow");if(this.toggled===false){this.$el.addClass("toggled");H.addClass("down");this.toggled=true}else{this.$el.removeClass("toggled");H.removeClass("down");this.toggled=false}return false},save:function(){if(this.collection.where({url:P.url}).length===0&&P.url.length!==0){var H="";S.each(I.models,function(T){H=H+T.get("crn")+" ("+T.get("subject_code")+" "+T.get("number")+") - "});H=H+"(page: "+L.page+")";this.collection.create({url:P.url,name:H})}}});p=new r();h=new l({collection:p});p.fetch();d=F.Router.extend({url:"",routes:{"":"index","c/:d":"fillCourseInput"},index:function(){i.add([new s(),new s()])},fillCourseInput:function(W){if(window.woopraTracker){window.woopraTracker.trackPageview({url:window.location.pathname+window.location.search,title:document.title})}var V=[],Z,Y,X,U,T=[],H;V=W.split("_");U=V.splice(0,1);U=U[0];X=V.splice(0,1);X=X[0].split("-");S.each(V,function(ab,aa){Y=ab.split("-");V[aa]={subject_id:Y[0],number:Y[1],crn:Y[2]}});this.url=W;Z=[];S.each(i.models,function(aa){Z.push(aa)});S.each(Z,function(aa){aa.clear()});i.reset();S.each(V,function(aa){i.add(new s(aa))});L.updateFilters(X);L.page=+U;S.each(V,function(aa,ab){if(aa.crn!==""){T.push("--"+aa.crn)}else{if(aa.subject_id!==""&&aa.number!==""){T.push(aa.subject_id+"-"+aa.number+"-")}}});T=S.sortBy(T,function(aa){return aa});H=U+"_"+X.join("-")+"_"+T.join("_")+".json?_="+f;I.url=c+"courses/fetch/"+H;G.loading(true);I.reset();I.fetch({complete:function(){G.loading(false)}})}});P=new d();F.history.start({pushState:true,root:c})}(jQuery,Backbone,_,Handlebars,amplify));