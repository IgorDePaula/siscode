(function(h,d,E,p,f){p.registerHelper("equal",function(G,I,H){if(arguments.length<3){throw new Error("Handlebars Helper equal needs 2 parameters")}if(+G!==+I){return H.inverse(this)}else{return H.fn(this)}});var k,w,B,g,b,j,v,o,F,c,m,u,D,a,A,e,s,r,n,t,z,y,x,q,i,C,l;l=h("body").data("cache_key");c=d.Model.extend({});m=d.Collection.extend({model:c});a=d.View.extend({template:p.compile(h("#course-input-subjects").html()),initialize:function(){this.$el.on("change",function(){console.log("Change!!!")})},render:function(){var G=[];E.each(this.collection.models,function(H){G.push(H.toJSON())});this.$el.html(this.template({subjects:G})).val(this.options.selected_id);return this}});k=d.Model.extend({defaults:{subject_id:null,number:null,crn:null},clear:function(){this.destroy()}});j=d.View.extend({tagName:"div",className:"cli-course-input",template:p.compile(h("#course-input-tmpl").html()),numberTemplate:p.compile(h("#course-input-numbers").html()),events:{"change select[name=subject_id]":"fillNumber","click .remove-course":"removeCourse","keyup .course-crn":"crnKeyUp"},crnKeyUp:function(G){if(this.$(G.srcElement).val().length>0){this.$("select").prop("disabled",true).trigger("liszt:updated")}else{this.$("select").prop("disabled",false).trigger("liszt:updated")}},fillNumber:function(){var I,H,G;I=this.$("select[name=subject_id]").val();if(I){G=D.get(I).toJSON()}else{G={numbers:[]}}this.$("select[name=number]").html(this.numberTemplate(G)).trigger("liszt:updated")},render:function(){var G,H=[],I;I=this.model.toJSON();E.each(D.models,function(J){H.push(J.toJSON())});I.subjects=H;this.$el.html(this.template(I)).find("select[name=subject_id]").val(this.model.get("subject_id")).trigger("change").end().find("select[name=number]").val(this.model.get("number"));return this},afterRender:function(){this.$("select").chosen()},initialize:function(){this.model.on("destroy",this.remove,this)},removeCourse:function(){this.model.clear()}});w=d.Collection.extend({model:k});g=d.View.extend({el:".cil",page:1,events:{"click #add-course":"addInputModel","click .cil-submit":"updateUrlEvent","keypress .course-input":"keyLog"},keyLog:function(G){if(G.keyCode===13){this.updateUrlEvent()}},initialize:function(){this.collection.on("add",this.addInput,this)},addInput:function(H){var G,I;G=new j({model:H});G.render();I=G.$el;this.$(".cil-courses").append(I);G.afterRender()},addInputModel:function(){this.collection.add(new k())},updateUrlEvent:function(){this.updateUrl()},updateUrl:function(I){if(I===f){this.page=1}else{if(I===-1){this.page-=1}else{if(I===1){this.page+=1}}}this.page=Math.max(1,this.page);var H=[],G="",K=[],J;this.$(".cli-course-input").each(function(){H.push([h(this).find("select[name=subject_id]").val(),h(this).find("select[name=number]").val(),h(this).find("input[name=crn]").val()])});E.each(H,function(L){G=G+L.join("-")+"_"});h('input[name^="filter"]').each(function(){if(h(this).prop("checked")){K.push(h(this).val())}});K=K.join("-")+"_";G="c/"+this.page+"_"+K+G.substr(0,G.length-1);F.navigate(G,{trigger:true})},updateFilters:function(I){var G,H;H=this;G=H.$('input[name^="filter"]');G.prop("checked",false);E.each(I,function(J){H.$('input[name="filter['+J+']"]').prop("checked",true)})}});u=h("#subjects-data").data("subjects");D=new m();D.reset(u);B=new w();b=new g({collection:B});x=d.Model.extend({});q=d.Collection.extend({model:x});A=d.Model.extend({});n=d.Collection.extend({model:A,maxPage:0,page:0,url:"/siscode/courses/fetch",colors:[{background:"#73A5F7",border:"#03F"},{background:"#FF828E",border:"#D80505"},{background:"#FF71FF",border:"#B300B3"},{background:"#FFFF80",border:"#FF0"},{background:"#AFA",border:"#80FF00"},{background:"#FFA980",border:"#FF8000"}],initialize:function(){this.on("reset",this.fixSlots,this)},fixSlots:function(J){var I,H,G;H=this;E.each(J.models,function(K,L){if(H.colors[L]!==f){G=H.colors[L]}else{G=H.colors[L%H.colors.length]}K.set("color",G);I=K.get("CourseSlot");E.each(I.models,function(M){M.courseModel=K})})},parse:function(G){var H=[];this.maxPage=G.pagination.total;this.page=G.pagination.page;E.each(G.content,function(K){var I=[],J;E.each(K.CourseSlot,function(L){I.push(new x(L))});J=K.Course;J.CourseSlot=new q(I);H.push(J)});return H}});z=d.View.extend({el:".schedule",initialize:function(){var G=this;this.collection.on("reset",this.addAll,this);this.$(".paginator").each(function(){h(this).html((new C({collection:G.collection})).render().$el)})},loading:function(G){if(G){this.$(".loader").show()}else{this.$(".loader").hide()}},addAll:function(H){this.$(".schedule-day").html("");var G=this;E.each(H.models,function(I){G.addOne(I)})},addOne:function(M){var H,L,K,J,N,I,G;K=this;E.each(M.get("CourseSlot").models,function(O){H=new i({model:O});H.render();L=K.$(".day-"+O.get("day"));L.append(H.$el);H.afterInsert();N=K.fixTime(O.get("start_time"));I=K.fixTime(O.get("end_time"));J=40+(N*40);G=40+(I*40)-J;H.$el.css({position:"absolute",top:J+"px",height:G+"px"})})},fixTime:function(G){G=G.split(":");G[0]=+G[0];G[1]=+G[1];G=(G[0]-7)+G[1]/60;return G}});i=d.View.extend({tagName:"div",className:"course-slot",render:function(){var G,I,H;G=h("#course-slot-view-tmpl").html();I=p.compile(G);H=this.model.toJSON();H.Course=this.model.courseModel.toJSON();this.$el.html(I(H));this.$(".course-slot-wrapper").css({backgroundColor:this.model.courseModel.get("color").background,borderColor:this.model.courseModel.get("color").border});return this},afterInsert:function(){this.$el.tooltip({tooltip:".tooltip-content"})}});C=d.View.extend({tagName:"div",events:{"click .next":"updateUrlNext","click .previous":"updateUrlPrevious"},updateUrlNext:function(){if(+this.collection.page<+this.collection.maxPage){b.updateUrl(1)}},updateUrlPrevious:function(){b.updateUrl(-1)},initialize:function(){this.collection.on("reset",this.render,this)},render:function(){var G,I,H;G=h("#pagination-view-tmpl").html();I=p.compile(G);H={page:this.collection.page,maxPage:this.collection.maxPage};this.$el.html(I(H));if(+this.collection.page>=+this.collection.maxPage){this.$(".next").addClass("disabled")}if(+this.collection.page===1){this.$(".previous").addClass("disabled")}if(this.collection.maxPage===0){this.$el.hide()}else{this.$el.show()}return this}});t=new n();y=new z({collection:t});o=d.Router.extend({routes:{"":"index","c/:d":"fillCourseInput"},index:function(){B.add([new k(),new k()])},fillCourseInput:function(K){var J=[],N,M,L,I,H=[],G;J=K.split("_");I=J.splice(0,1);I=I[0];L=J.splice(0,1);L=L[0].split("-");E.each(J,function(P,O){M=P.split("-");J[O]={subject_id:M[0],number:M[1],crn:M[2]}});N=[];E.each(B.models,function(O){N.push(O)});E.each(N,function(O){O.clear()});E.each(J,function(O){B.add(new k(O))});b.updateFilters(L);b.page=+I;E.each(J,function(O,P){if(O.crn!==""){H.push("--"+O.crn)}else{if(O.subject_id!==""&&O.number!==""){H.push(O.subject_id+"-"+O.number+"-")}}});H=E.sortBy(H,function(O){return O});G=I+"_"+L.join("-")+"_"+H.join("_")+".json?_="+l;t.url="/siscode/courses/fetch/"+G;y.loading(true);t.reset();t.fetch({complete:function(){y.loading(false)}})}});F=new o();d.history.start({pushState:true,root:"/siscode/"})}(jQuery,Backbone,_,Handlebars));