(function(y,B,O,i,t,w){i.registerHelper("equal",function(H,Q,P){if(arguments.length<3){throw new Error("Handlebars Helper equal needs 2 parameters")}if(+H!==+Q){return P.inverse(this)}else{return P.fn(this)}});var q,J,h,K,G,d,a,c,L,f,M,I,r,F,k,v,l,x,z,D,s,C,o,E,A,m,u,N,p,j,n,g,e,b;b=y("body").data("webroot");e=y("body").data("cache_key");f=B.Model.extend({});M=B.Collection.extend({model:f});F=B.View.extend({template:i.compile(y("#course-input-subjects").html()),render:function(){var H=[];O.each(this.collection.models,function(P){H.push(P.toJSON())});this.$el.html(this.template({subjects:H})).val(this.options.selected_id);return this}});q=B.Model.extend({defaults:{subject_id:null,number:null,crn:null},clear:function(){this.destroy()}});d=B.View.extend({tagName:"div",className:"cli-course-input",template:i.compile(y("#course-input-tmpl").html()),numberTemplate:i.compile(y("#course-input-numbers").html()),events:{"change select[name=subject_id]":"fillNumber","click .remove-course":"removeCourse","keyup .course-crn":"crnKeyUp"},crnKeyUp:function(H){if(this.$(H.target).val().length>0){this.$("select").prop("disabled",true).trigger("liszt:updated")}else{this.$("select").prop("disabled",false).trigger("liszt:updated")}},fillNumber:function(){var Q,P,H;Q=this.$("select[name=subject_id]").val();if(Q){H=r.get(Q).toJSON()}else{H={numbers:[]}}this.$("select[name=number]").html(this.numberTemplate(H)).trigger("liszt:updated")},render:function(){var H,P=[],Q;Q=this.model.toJSON();O.each(r.models,function(R){P.push(R.toJSON())});Q.subjects=P;this.$el.html(this.template(Q)).find("select[name=subject_id]").val(this.model.get("subject_id")).trigger("change").end().find("select[name=number]").val(this.model.get("number"));return this},afterRender:function(){this.$("select").chosen()},initialize:function(){this.model.on("destroy",this.remove,this)},removeCourse:function(){this.model.clear()}});J=B.Collection.extend({model:q});K=B.View.extend({el:".cil",page:1,events:{"click #add-course":"addInputModel","click .cil-submit":"updateUrlEvent","keypress .course-input":"keyLog"},keyLog:function(H){if(H.keyCode===13){this.updateUrlEvent()}},initialize:function(){this.collection.on("add",this.addInput,this)},addInput:function(P){var H,Q;H=new d({model:P});H.render();Q=H.$el;this.$(".cil-courses").append(Q);H.afterRender()},addInputModel:function(){this.collection.add(new q())},updateUrlEvent:function(){this.updateUrl()},updateUrl:function(Q){if(Q===w){this.page=1}else{if(Q===-1){this.page-=1}else{if(Q===1){this.page+=1}}}this.page=Math.max(1,this.page);var P=[],H="",S=[],R;this.$(".cli-course-input").each(function(){P.push([y(this).find("select[name=subject_id]").val(),y(this).find("select[name=number]").val(),y(this).find("input[name=crn]").val()])});O.each(P,function(T){H=H+T.join("-")+"_"});y('input[name^="filter"]').each(function(){if(y(this).prop("checked")){S.push(y(this).val())}});S=S.join("-")+"_";H="c/"+this.page+"_"+S+H.substr(0,H.length-1);L.navigate(H,{trigger:true})},updateFilters:function(Q){var H,P;P=this;H=P.$('input[name^="filter"]');H.prop("checked",false);O.each(Q,function(R){P.$('input[name="filter['+R+']"]').prop("checked",true)})}});I=y("#subjects-data").data("subjects");r=new M();r.reset(I);h=new J();G=new K({collection:h});o=B.Model.extend({});E=B.Collection.extend({model:o});k=B.Model.extend({});z=B.Collection.extend({model:k,maxPage:0,page:0,url:b+"courses/fetch",colors:[{background:"#73A5F7",border:"#03F"},{background:"#FF828E",border:"#D80505"},{background:"#FF71FF",border:"#B300B3"},{background:"#FFFF80",border:"#FF0"},{background:"#AFA",border:"#80FF00"},{background:"#FFA980",border:"#FF8000"}],initialize:function(){this.on("reset",this.fixSlots,this)},fixSlots:function(R){var Q,P,H;P=this;O.each(R.models,function(S,T){if(P.colors[T]!==w){H=P.colors[T]}else{H=P.colors[T%P.colors.length]}S.set("color",H);Q=S.get("CourseSlot");O.each(Q.models,function(U){U.courseModel=S})})},parse:function(H){var P=[];this.maxPage=H.pagination.total;this.page=H.pagination.page;O.each(H.content,function(S){var Q=[],R;O.each(S.CourseSlot,function(T){Q.push(new o(T))});S.Course.subject_code=r.get(S.Course.subject_id).get("code");R=S.Course;R.CourseSlot=new E(Q);P.push(R)});return P}});s=B.View.extend({el:".schedule",initialize:function(){var H=this;this.collection.on("reset",this.addAll,this);this.$(".paginator").each(function(){y(this).html((new m({collection:H.collection})).render().$el)})},loading:function(H){if(H){this.$(".loader").show()}else{this.$(".loader").hide()}},addAll:function(P){this.$(".schedule-day").html("");var H=this;O.each(P.models,function(Q){H.addOne(Q)})},addOne:function(U){var P,T,S,R,V,Q,H;S=this;O.each(U.get("CourseSlot").models,function(W){P=new A({model:W});P.render();T=S.$(".day-"+W.get("day"));T.append(P.$el);P.afterInsert();V=S.fixTime(W.get("start_time"));Q=S.fixTime(W.get("end_time"));R=40+(V*40);H=40+(Q*40)-R;P.$el.css({position:"absolute",top:R+"px",height:H+"px"})})},fixTime:function(H){H=H.split(":");H[0]=+H[0];H[1]=+H[1];H=(H[0]-7)+H[1]/60;return H}});A=B.View.extend({tagName:"div",className:"course-slot",render:function(){var H,Q,P;H=y("#course-slot-view-tmpl").html();Q=i.compile(H);P=this.model.toJSON();P.Course=this.model.courseModel.toJSON();P.start_time=P.start_time.substr(0,5);P.end_time=P.end_time.substr(0,5);this.$el.html(Q(P));this.$(".course-slot-wrapper").css({backgroundColor:this.model.courseModel.get("color").background,borderColor:this.model.courseModel.get("color").border});return this},afterInsert:function(){this.$el.tooltip({tooltip:".tooltip-content"})}});m=B.View.extend({tagName:"div",events:{"click .next":"updateUrlNext","click .previous":"updateUrlPrevious"},updateUrlNext:function(){if(+this.collection.page<+this.collection.maxPage){G.updateUrl(1)}},updateUrlPrevious:function(){G.updateUrl(-1)},initialize:function(){this.collection.on("reset",this.render,this)},render:function(){var H,Q,P;H=y("#pagination-view-tmpl").html();Q=i.compile(H);P={page:this.collection.page,maxPage:this.collection.maxPage};this.$el.html(Q(P));if(+this.collection.page>=+this.collection.maxPage){this.$(".next").addClass("disabled")}if(+this.collection.page===1){this.$(".previous").addClass("disabled")}if(this.collection.maxPage===0){this.$el.hide()}else{this.$el.show()}return this}});D=new z();C=new s({collection:D});u=B.Model.extend({defaults:{url:null,name:null},sync:function(U,Q,P){var R,S,T,H;if(U==="create"){R=t.store("savedCombinations");if(!R){R=[]}S=this.toJSON();S.id=O.uniqueId();R.push(S);t.store("savedCombinations",R);P.success(S)}else{if(U==="delete"){T=Q.get("id");R=t.store("savedCombinations",R);H=null;O.each(R,function(W,V){if(W.id===T){H=V;return false}});if(H!==null){R.splice(H,1)}t.store("savedCombinations",R)}else{if(U==="update"){T=Q.get("id");R=t.store("savedCombinations",R);H=null;O.each(R,function(W,V){if(W.id===T){R[V]=Q.toJSON();return false}});t.store("savedCombinations",R)}}}},clear:function(){this.destroy()}});N=B.View.extend({tagName:"li",editMode:false,$template:i.compile(y("#foot-bar-combination-tmpl").html()),events:{"click a":"goToSavedUrl","click .foot-bar-remove":"removeCombination","click .foot-bar-edit":"editCombination","keypress input":"updateCombination"},editCombination:function(){if(this.editMode){this.update()}else{this.editMode=true;this.$(".foot-bar-combination-name").hide();this.$("input").show().focus().select()}return false},updateCombination:function(H){if(H.keyCode===13){this.update()}},update:function(){var H;this.$(".foot-bar-combination-name").show();H=this.$("input").hide().val();this.model.save({name:H});this.editMode=false},removeCombination:function(){this.model.clear();return false},goToSavedUrl:function(){L.navigate("c/"+this.model.get("url"),{trigger:true});return false},initialize:function(){this.model.on("destroy",this.remove,this);this.model.on("change:name",this.render,this)},render:function(){this.$el.html(this.$template(this.model.toJSON()));return this}});p=B.Collection.extend({model:u,sync:function(R,Q,H){if(R==="read"){var P;P=t.store("savedCombinations");H.success(P)}}});j=B.View.extend({el:".foot-bar",toggled:false,events:{"click .foot-bar-arrow":"toggleFoot","click .foot-bar-add":"save"},initialize:function(){this.collection.on("add",this.addOne,this);this.collection.on("reset",this.addAll,this)},addAll:function(P){var H;H=this;O.each(P.models,function(Q){H.addSaved(Q,true)})},addOne:function(H){this.addSaved(H)},addSaved:function(P,R){var H,Q;H=new N({model:P});H.render();Q=H.$el;this.$(".foot-bar-combination").prepend(Q);if(!R){H.editCombination();if(!this.toggled){this.toggleFoot()}}},toggleFoot:function(){var H;H=this.$(".foot-bar-arrow");if(this.toggled===false){this.$el.css("bottom","0px");H.addClass("down");this.toggled=true}else{this.$el.css("bottom",-(this.$el.height()-40)+"px");H.removeClass("down");this.toggled=false}},save:function(){if(this.collection.where({url:L.url}).length===0&&L.url.length!==0){var H="";O.each(D.models,function(P){H=H+P.get("crn")+" ("+P.get("subject_code")+" "+P.get("number")+") - "});H=H+"(page: "+G.page+")";this.collection.create({url:L.url,name:H})}}});n=new p();g=new j({collection:n});n.fetch();c=B.Router.extend({url:"",routes:{"":"index","c/:d":"fillCourseInput"},index:function(){h.add([new q(),new q()])},fillCourseInput:function(S){var R=[],V,U,T,Q,P=[],H;R=S.split("_");Q=R.splice(0,1);Q=Q[0];T=R.splice(0,1);T=T[0].split("-");O.each(R,function(X,W){U=X.split("-");R[W]={subject_id:U[0],number:U[1],crn:U[2]}});this.url=S;V=[];O.each(h.models,function(W){V.push(W)});O.each(V,function(W){W.clear()});O.each(R,function(W){h.add(new q(W))});G.updateFilters(T);G.page=+Q;O.each(R,function(W,X){if(W.crn!==""){P.push("--"+W.crn)}else{if(W.subject_id!==""&&W.number!==""){P.push(W.subject_id+"-"+W.number+"-")}}});P=O.sortBy(P,function(W){return W});H=Q+"_"+T.join("-")+"_"+P.join("_")+".json?_="+e;D.url=b+"courses/fetch/"+H;C.loading(true);D.reset();D.fetch({complete:function(){C.loading(false)}})}});L=new c();B.history.start({pushState:true,root:b})}(jQuery,Backbone,_,Handlebars,amplify));