(function(A,D,Q,i,u,y){i.registerHelper("equal",function(H,S,R){if(arguments.length<3){throw new Error("Handlebars Helper equal needs 2 parameters")}if(+H!==+S){return R.inverse(this)}else{return R.fn(this)}});var r,L,h,M,J,d,a,c,N,f,O,K,s,I,l,w,m,z,B,F,t,E,p,G,C,n,v,P,q,k,o,g,j,x,e,b;b=A("body").data("webroot");e=A("body").data("cache_key");j=D.View.extend({el:"body",events:{keyup:"keyup"},keyup:function(H){if(A(H.target).is("input")){return}if(H.keyCode===37){this.trigger("leftArrowUp")}else{if(H.keyCode===39){this.trigger("rightArrowUp")}}}});x=new j();f=D.Model.extend({});O=D.Collection.extend({model:f});I=D.View.extend({template:i.compile(A("#course-input-subjects").html()),render:function(){var H=[];Q.each(this.collection.models,function(R){H.push(R.toJSON())});this.$el.html(this.template({subjects:H})).val(this.options.selected_id);return this}});r=D.Model.extend({defaults:{subject_id:null,number:null,crn:null},clear:function(){this.destroy()}});d=D.View.extend({tagName:"div",className:"cli-course-input",template:i.compile(A("#course-input-tmpl").html()),numberTemplate:i.compile(A("#course-input-numbers").html()),events:{"change select[name=subject_id]":"fillNumber","click .remove-course":"removeCourse","keyup .course-crn":"crnKeyUp"},crnKeyUp:function(H){if(this.$(H.target).val().length>0){this.$("select").prop("disabled",true).trigger("liszt:updated")}else{this.$("select").prop("disabled",false).trigger("liszt:updated")}},fillNumber:function(){var S,R,H;S=this.$("select[name=subject_id]").val();if(S){H=s.get(S).toJSON()}else{H={numbers:[]}}this.$("select[name=number]").html(this.numberTemplate(H)).trigger("liszt:updated")},render:function(){var H,R=[],S;S=this.model.toJSON();Q.each(s.models,function(T){R.push(T.toJSON())});S.subjects=R;this.$el.html(this.template(S)).find("select[name=subject_id]").val(this.model.get("subject_id")).trigger("change").end().find("select[name=number]").val(this.model.get("number"));return this},afterRender:function(){this.$("select").chosen()},initialize:function(){this.model.on("destroy",this.remove,this)},removeCourse:function(){this.model.clear()}});L=D.Collection.extend({model:r});M=D.View.extend({el:".cil",page:0,events:{"click #add-course":"addInputModel","click .cil-submit":"updateUrlEvent","keypress .course-input":"keyLog"},keyLog:function(H){if(H.keyCode===13){this.updateUrlEvent()}},initialize:function(){this.collection.on("add",this.addInput,this);x.on("leftArrowUp",this.updatePrevious,this);x.on("rightArrowUp",this.updateNext,this)},updatePrevious:function(){this.updateUrl(-1)},updateNext:function(){this.updateUrl(1)},addInput:function(R){var H,S;H=new d({model:R});H.render();S=H.$el;this.$(".cil-courses").append(S);H.afterRender()},addInputModel:function(){this.collection.add(new r())},updateUrlEvent:function(){this.updateUrl()},updateUrl:function(S){if(S===y){this.page=1}else{if(S===-1){this.page-=1}else{if(S===1){this.page+=1}}}this.page=Math.max(1,this.page);var R=[],H="",U=[],T;this.$(".cli-course-input").each(function(){R.push([A(this).find("select[name=subject_id]").val(),A(this).find("select[name=number]").val(),A(this).find("input[name=crn]").val()])});Q.each(R,function(V){H=H+V.join("-")+"_"});A('input[name^="filter"]').each(function(){if(A(this).prop("checked")){U.push(A(this).val())}});U=U.join("-")+"_";H="c/"+this.page+"_"+U+H.substr(0,H.length-1);N.navigate(H,{trigger:true})},updateFilters:function(S){var H,R;R=this;H=R.$('input[name^="filter"]');H.prop("checked",false);Q.each(S,function(T){R.$('input[name="filter['+T+']"]').prop("checked",true)})}});K=A("#subjects-data").data("subjects");s=new O();s.reset(K);h=new L();J=new M({collection:h});p=D.Model.extend({});G=D.Collection.extend({model:p});l=D.Model.extend({});B=D.Collection.extend({model:l,maxPage:0,page:0,url:b+"courses/fetch",colors:[{background:"#73A5F7",border:"#03F"},{background:"#FF828E",border:"#D80505"},{background:"#FF71FF",border:"#B300B3"},{background:"#FFFF80",border:"#FF0"},{background:"#AFA",border:"#80FF00"},{background:"#FFA980",border:"#FF8000"}],initialize:function(){this.on("reset",this.fixSlots,this)},fixSlots:function(T){var S,R,H;R=this;Q.each(T.models,function(U,V){if(R.colors[V]!==y){H=R.colors[V]}else{H=R.colors[V%R.colors.length]}U.set("color",H);S=U.get("CourseSlot");Q.each(S.models,function(W){W.courseModel=U})})},parse:function(H){var R=[];this.maxPage=H.pagination.total;this.page=H.pagination.page;Q.each(H.content,function(U){var S=[],T;Q.each(U.CourseSlot,function(V){S.push(new p(V))});U.Course.subject_code=s.get(U.Course.subject_id).get("code");T=U.Course;T.CourseSlot=new G(S);R.push(T)});return R}});t=D.View.extend({el:".schedule",errorMessages:["No results! Take a break this semester, work at McDonalds instead","No results! Seriously, flipping burgers is fun","No results! I like fries with my burger","No results! One tawouk, toum extra please","Hooray! No need to come to uni this semester. Just kidding, No results","No results! Have you considered dropping out?","No results! Try LUCK 101","No results! Never give up, Bill Gates was a dropout and look where he is today"],initialize:function(){var H=this;this.collection.on("reset",this.addAll,this);this.$(".paginator").each(function(){A(this).html((new n({collection:H.collection})).render().$el)})},loading:function(H){if(H){this.$(".loader").show()}else{this.$(".loader").hide()}},addAll:function(S){var H,R;this.$(".schedule-day").html("");R=this;H=this.$(".empty-error");if(S.maxPage===0){H.html(this.errorMessages[Math.floor(Math.random()*this.errorMessages.length)]);H.show()}else{H.hide()}Q.each(S.models,function(T){R.addOne(T)})},addOne:function(W){var R,V,U,T,X,S,H;U=this;Q.each(W.get("CourseSlot").models,function(Y){R=new C({model:Y});R.render();V=U.$(".day-"+Y.get("day"));V.append(R.$el);R.afterInsert();X=U.fixTime(Y.get("start_time"));S=U.fixTime(Y.get("end_time"));T=40+(X*40);H=40+(S*40)-T;R.$el.css({position:"absolute",top:T+"px",height:H+"px"})})},fixTime:function(H){H=H.split(":");H[0]=+H[0];H[1]=+H[1];H=(H[0]-7)+H[1]/60;return H}});C=D.View.extend({tagName:"div",className:"course-slot",render:function(){var H,S,R;H=A("#course-slot-view-tmpl").html();S=i.compile(H);R=this.model.toJSON();R.Course=this.model.courseModel.toJSON();R.start_time=R.start_time.substr(0,5);R.end_time=R.end_time.substr(0,5);this.$el.html(S(R));this.$(".course-slot-wrapper").css({backgroundColor:this.model.courseModel.get("color").background,borderColor:this.model.courseModel.get("color").border});return this},afterInsert:function(){this.$el.tooltip({tooltip:".tooltip-content"})}});n=D.View.extend({tagName:"div",events:{"click .next":"updateUrlNext","click .previous":"updateUrlPrevious"},updateUrlNext:function(){if(+this.collection.page<+this.collection.maxPage){J.updateUrl(1)}},updateUrlPrevious:function(){J.updateUrl(-1)},initialize:function(){this.collection.on("reset",this.render,this)},render:function(){var H,S,R;H=A("#pagination-view-tmpl").html();S=i.compile(H);R={page:this.collection.page,maxPage:this.collection.maxPage};this.$el.html(S(R));if(+this.collection.page>=+this.collection.maxPage){this.$(".next").addClass("disabled")}if(+this.collection.page===1){this.$(".previous").addClass("disabled")}if(this.collection.maxPage===0){this.$el.hide()}else{this.$el.show()}return this}});F=new B();E=new t({collection:F});v=D.Model.extend({defaults:{url:null,name:null},sync:function(W,S,R){var T,U,V,H;if(W==="create"){T=u.store("savedCombinations");if(!T){T=[]}U=this.toJSON();U.id=Q.uniqueId();T.push(U);u.store("savedCombinations",T);R.success(U)}else{if(W==="delete"){V=S.get("id");T=u.store("savedCombinations",T);H=null;Q.each(T,function(Y,X){if(Y.id===V){H=X;return false}});if(H!==null){T.splice(H,1)}u.store("savedCombinations",T)}else{if(W==="update"){V=S.get("id");T=u.store("savedCombinations",T);H=null;Q.each(T,function(Y,X){if(Y.id===V){T[X]=S.toJSON();return false}});u.store("savedCombinations",T)}}}},clear:function(){this.destroy()}});P=D.View.extend({tagName:"li",editMode:false,$template:i.compile(A("#foot-bar-combination-tmpl").html()),events:{"click a":"goToSavedUrl","click .foot-bar-remove":"removeCombination","click .foot-bar-edit":"editCombination","keypress input":"updateCombination"},editCombination:function(){if(this.editMode){this.update()}else{this.editMode=true;this.$(".foot-bar-combination-name").hide();this.$("input").show().focus().select()}return false},updateCombination:function(H){if(H.keyCode===13){this.update()}},update:function(){var H;this.$(".foot-bar-combination-name").show();H=this.$("input").hide().val();this.model.save({name:H});this.editMode=false},removeCombination:function(){this.model.clear();return false},goToSavedUrl:function(){N.navigate("c/"+this.model.get("url"),{trigger:true});return false},initialize:function(){this.model.on("destroy",this.remove,this);this.model.on("change:name",this.render,this)},render:function(){this.$el.html(this.$template(this.model.toJSON()));return this}});q=D.Collection.extend({model:v,sync:function(T,S,H){if(T==="read"){var R;R=u.store("savedCombinations");H.success(R)}}});k=D.View.extend({el:".foot-bar",toggled:false,events:{"click .foot-bar-toggle":"toggleFoot","click .foot-bar-add":"save"},initialize:function(){this.collection.on("add",this.addOne,this);this.collection.on("reset",this.addAll,this)},addAll:function(R){var H;H=this;Q.each(R.models,function(S){H.addSaved(S,true)})},addOne:function(H){this.addSaved(H)},addSaved:function(R,T){var H,S;H=new P({model:R});H.render();S=H.$el;this.$(".foot-bar-combination").prepend(S);if(!T){H.editCombination();if(!this.toggled){this.toggleFoot()}}},toggleFoot:function(){var H;H=this.$(".foot-bar-arrow");if(this.toggled===false){this.$el.css("bottom","0px");H.addClass("down");this.toggled=true}else{this.$el.css("bottom",-(this.$el.height()-40)+"px");H.removeClass("down");this.toggled=false}},save:function(){if(this.collection.where({url:N.url}).length===0&&N.url.length!==0){var H="";Q.each(F.models,function(R){H=H+R.get("crn")+" ("+R.get("subject_code")+" "+R.get("number")+") - "});H=H+"(page: "+J.page+")";this.collection.create({url:N.url,name:H})}}});o=new q();g=new k({collection:o});o.fetch();c=D.Router.extend({url:"",routes:{"":"index","c/:d":"fillCourseInput"},index:function(){h.add([new r(),new r()])},fillCourseInput:function(U){var T=[],X,W,V,S,R=[],H;T=U.split("_");S=T.splice(0,1);S=S[0];V=T.splice(0,1);V=V[0].split("-");Q.each(T,function(Z,Y){W=Z.split("-");T[Y]={subject_id:W[0],number:W[1],crn:W[2]}});this.url=U;X=[];Q.each(h.models,function(Y){X.push(Y)});Q.each(X,function(Y){Y.clear()});Q.each(T,function(Y){h.add(new r(Y))});J.updateFilters(V);J.page=+S;Q.each(T,function(Y,Z){if(Y.crn!==""){R.push("--"+Y.crn)}else{if(Y.subject_id!==""&&Y.number!==""){R.push(Y.subject_id+"-"+Y.number+"-")}}});R=Q.sortBy(R,function(Y){return Y});H=S+"_"+V.join("-")+"_"+R.join("_")+".json?_="+e;F.url=b+"courses/fetch/"+H;E.loading(true);F.reset();F.fetch({complete:function(){E.loading(false)}})}});N=new c();D.history.start({pushState:true,root:b})}(jQuery,Backbone,_,Handlebars,amplify));